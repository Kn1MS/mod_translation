namespace = carnx_sex_scene

# 0001. Generic consensual scene
# 0003. Generic dubcon / noncon scene (dom)
# 0004. Generic dubcon / noncon scene (sub)

carnx_sex_scene.0001 = {
	type = character_event
	title = carn_sex_scene.0001.t
	desc = {
		desc = carn_sex_scene.0001.desc_opening
		desc = carn_sex_scene.0001.desc_ending
	}

	theme = seduction
	override_background = {
		trigger = {
			OR = {
				NOT = { has_variable = sex_scene_location }
				var:sex_scene_location = flag:private_chamber
			}
		}
		reference = bedchamber
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:garden
			}
		}
		reference = garden
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:stable
			}
		}
		reference = armory
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:copse
			}
		}
		reference = terrain
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:kitchen
			}
		}
		reference = bp1_kitchen_western
	}

	left_portrait = {
		character = scope:carn_sex_player
		animation = flirtation
	}
	right_portrait = {
		character = scope:carn_sex_target
		animation = love
	}

	trigger = {
		carn_sex_scene_is_consensual = yes
		carn_sex_scene_matches_requested_flags_trigger = yes
	}

	immediate = {
		carn_sex_scene_is_consensual = yes

		carn_had_sex_with_effect = {
			CHARACTER_1 = scope:carn_sex_player
			CHARACTER_2 = scope:carn_sex_target
			C1_PREGNANCY_CHANCE = pregnancy_chance
			C2_PREGNANCY_CHANCE = pregnancy_chance
			STRESS_EFFECTS = scope:carn_sex_stress_effects
			DRAMA = scope:carn_sex_drama
		}

		scope:carn_sex_player = {
			carn_undress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_undress_character_effect = yes
		}

		random = {
			chance = 30
			if = {
				limit = {
					scope:carn_sex_player = {
						OR = {
							has_relation_lover = scope:carn_sex_target
							has_relation_soulmate = scope:carn_sex_target
						}
					}
				}
				set_random_sex_scene_location_effect = yes
			}
			else = {
				carnx_set_sex_scene_location_effect = yes
			}
		}
	}

	after = {
		scope:carn_sex_player = {
			carn_dress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_dress_character_effect = yes
		}

		carnx_remove_sex_scene_location_effect = yes
	}

	option = {
		name = carn_sex_scene.0001.a
	}
}

carnx_sex_scene.0003 = {
	type = character_event
	title = carnx_sex_scene.0003.t
	desc = {
		desc = carnx_sex_scene.0003.desc_opening
		desc = carnx_sex_scene.0003.desc_ending
	}

	theme = seduction
	override_background = {
		trigger = {
			OR = {
				NOT = { has_variable = sex_scene_location }
				var:sex_scene_location = flag:private_chamber
			}
		}
		reference = bedchamber
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:garden
			}
		}
		reference = garden
	}

	left_portrait = {
		character = scope:carn_sex_player
		animation = personality_dishonorable
	}
	right_portrait = {
		character = scope:carn_sex_target
		animation = personality_cynical
	}

	trigger = {
		carn_sex_scene_is_dubcon = yes
		carn_sex_scene_is_noncon = yes
		carn_sex_scene_is_dom_player = yes
		carn_sex_scene_matches_requested_flags_trigger = yes
	}

	immediate = {
		carn_sex_scene_is_dubcon = yes
		carn_sex_scene_is_noncon = yes
		carn_sex_scene_is_dom_player = yes

		carn_had_sex_with_effect = {
			CHARACTER_1 = scope:carn_sex_player
			CHARACTER_2 = scope:carn_sex_target
			C1_PREGNANCY_CHANCE = pregnancy_chance
			C2_PREGNANCY_CHANCE = pregnancy_chance
			STRESS_EFFECTS = scope:carn_sex_stress_effects
			DRAMA = scope:carn_sex_drama
		}

		scope:carn_sex_player = {
			carn_undress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_undress_character_effect = yes
		}

		random = {
			chance = 50
			carnx_set_sex_scene_location_effect = yes
		}
	}

	after = {
		scope:carn_sex_player = {
			carn_dress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_dress_character_effect = yes
		}

		carnx_remove_sex_scene_location_effect = yes
	}

	option = {
		name = carnx_sex_scene.0003.a
	}
}

carnx_sex_scene.0004 = {
	type = character_event
	title = carnx_sex_scene.0004.t
	desc = {
		desc = carnx_sex_scene.0004.desc_opening
		desc = carnx_sex_scene.0004.desc_ending
	}

	theme = seduction
	override_background = {
		trigger = {
			OR = {
				NOT = { has_variable = sex_scene_location }
				var:sex_scene_location = flag:private_chamber
			}
		}
		reference = bedchamber
	}
	override_background = {
		trigger = {
			AND = {
				has_variable = sex_scene_location
				var:sex_scene_location = flag:garden
			}
		}
		reference = garden
	}

	left_portrait = {
		character = scope:carn_sex_player
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:carn_sex_target
		animation = personality_dishonorable
	}

	trigger = {
		carn_sex_scene_is_dubcon = yes
		carn_sex_scene_is_noncon = yes
		carn_sex_scene_is_sub_player = yes
		carn_sex_scene_matches_requested_flags_trigger = yes
	}

	immediate = {
		carn_sex_scene_is_dubcon = yes
		carn_sex_scene_is_noncon = yes
		carn_sex_scene_is_sub_player = yes

		carn_had_sex_with_effect = {
			CHARACTER_1 = scope:carn_sex_player
			CHARACTER_2 = scope:carn_sex_target
			C1_PREGNANCY_CHANCE = pregnancy_chance
			C2_PREGNANCY_CHANCE = pregnancy_chance
			STRESS_EFFECTS = scope:carn_sex_stress_effects
			DRAMA = scope:carn_sex_drama
		}

		scope:carn_sex_player = {
			carn_undress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_undress_character_effect = yes
		}

		random = {
			chance = 50
			carnx_set_sex_scene_location_effect = yes
		}
	}

	after = {
		scope:carn_sex_player = {
			carn_dress_character_effect = yes
		}
		scope:carn_sex_target = {
			carn_dress_character_effect = yes
		}

		carnx_remove_sex_scene_location_effect = yes
	}

	option = {
		name = carnx_sex_scene.0004.a
	}
}

